<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Research Office ‚Äî zeta-zero-cafe</title>

  <!-- Only the Research Office stylesheet (scoped to body.ro) -->
  <link rel="stylesheet" href="/css/10-components/research-office.css" />

  <!-- MathJax config (same one chapters use) -->
  <script src="/cafes/zeta-zero-cafe/notebook/math/mathconfig.js"></script>
</head>
<body class="ro">

<header class="ro-head">
  <a class="ro-back" href="javascript:history.back()">‚Üê Back</a>
  <h1>Research Office ‚Äî <span class="mono">zeta-zero-cafe</span></h1>
</header>

<main class="ro-main">
  <!-- LEFT: stage (thumbnail + SVG overlay + toolbar) -->
  <section class="ro-left">
    <div id="stagewrap" class="card">
      <div id="ro-stage">
        <!-- Everything that must zoom/scroll together lives in #ro-inner -->
        <div id="ro-inner">
          <img id="ro-page" alt="source page" />
          <svg id="ro-svg" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"></svg>
        </div>
      </div>

      <!-- Toolbar -->
      <div class="ro-toolbar">
        <div class="toolrow">
          <button id="toolPoint" class="btn">Point</button>
          <button id="toolBox"   class="btn">Box</button>
          <span class="sep"></span>
          <span>Zoom:</span>
          <button id="zoomOut" class="btn">‚Äì</button>
          <button id="zoomFit" class="btn">Fit</button>
          <button id="zoomIn"  class="btn">+</button>
          <span class="sep"></span>
          <label>Units:
            <select id="unitsSel">
              <option value="mm" selected>mm</option>
              <option value="cm">cm</option>
            </select>
          </label>
          <span class="sep"></span>
          <button id="exportJson" class="btn">Export JSON</button>
        </div>
        <div id="token" class="tiny mono muted">click marker to copy</div>
      </div>
    </div>

    <!-- Paragraph preview -->
    <div class="card ro-preview">
      <div class="row">
        <strong>Paragraph preview</strong>
        <span id="paranum" class="tag">#</span>
      </div>
      <div id="paraPreview" class="preview-body"></div>
    </div>

    <div class="row tiny muted">
      <div>Figures</div><div>Tables</div>
    </div>
  </section>

  <!-- RIGHT: memo -->
  <section class="ro-right">
    <div class="card">
      <div class="row">
        <strong>Memo to self (Markdown + LaTeX)</strong>
        <div class="mini-toolbar">
          <button data-md="b"  class="btn mini">B</button>
          <button data-md="i"  class="btn mini">/</button>
          <button data-md="cb" class="btn mini">{ }</button>
          <button data-md="lnk" class="btn mini">üîó</button>
          <button id="mjBtn"   class="btn mini">\(x\)</button>
          <button id="previewBtn" class="btn mini">Preview</button>
        </div>
      </div>
      <textarea id="memo" rows="10" placeholder="State the issue, desired change, and rationale..."></textarea>
      <div id="memoOut" class="memo-out"></div>

      <div class="toolrow">
        <button id="saveDraft" class="btn">Save draft</button>
        <button id="saveVersion" class="btn">Save version</button>
        <button id="exportMemo" class="btn">Export memo JSON</button>
        <button id="exportAll"  class="btn">Export ALL drafts</button>
        <input id="importFile" type="file" />
        <button id="submitBtn" class="btn">Submit via Discord</button>
      </div>

      <div class="tiny muted">
        Autosave is ON (on every keystroke + periodically). Draft ‚Üí step away ‚Üí revise ‚Üí submit.
      </div>

      <h4>Versions (snapshots for this memo)</h4>
      <div class="tiny muted">No snapshots yet.</div>

      <h4>Recent drafts (this browser)</h4>
      <div class="tiny muted">‚Äî</div>
    </div>
  </section>
</main>

<!-- Grid / overlay logic -->
<script src="/js/research-office-grid.js"></script>
<!-- Page logic (params, preview, memo, autosave, MathJax/marked loaders) -->
<script src="/js/research.office.js"></script>

<script>
  (async function () {
    // URL params
    const u = new URL(location.href);
    const from    = Number(u.searchParams.get('from') || u.searchParams.get('page') || 0);
    const chapter = u.searchParams.get('chapter') || '';
    const para    = u.searchParams.get('para') || '';

    // Initialize the overlay/grid
    if (window.initResearchOfficeGrid) {
      window.initResearchOfficeGrid({
        fromPage: from || 1,
        units: 'mm',
        // Default: A4 portrait; we‚Äôll auto-swap to landscape if needed
        pageMM: { w: 210, h: 297 },
        // Where thumbnails live
        thumbsBase: '/cafes/zeta-zero-cafe/sources/thumbs'
      });
    }

    // Initialize the memo + paragraph preview pipeline
    if (window.initResearchOffice) {
      window.initResearchOffice({ chapter, para });
    }
  })();
</script>
</body>
</html>
